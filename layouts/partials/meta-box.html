{{/* Path: layouts/partials/meta-box.html (Final Version) */}}

{{ $currentSection := .Section }}
{{ $currentType := .Type }}

{{/* --- Logic cho Section/Type "noi-that" --- */}}
{{ if or (eq $currentSection "noi-that") (eq $currentType "noi-that") }}
    {{ $hasNoiThatParams := false }}
    {{ $noiThatFields := slice "ma_san_pham" "chat_lieu" "mau_sac" "kich_thuoc" "xuat_xu" "bao_hanh" "thuong_hieu" "gia_ban" }}
    {{ range $noiThatFields }}
        {{ if isset $.Params . }}
            {{ $hasNoiThatParams = true }}
        {{ end }}
    {{ end }}

    {{ if $hasNoiThatParams }}
    {{/* Thêm d-flex flex-column để đẩy nút xuống dưới cùng với mt-auto */}}
    <div class="meta-box meta-box-decorated p-3 border rounded h-100 shadow-sm d-flex flex-column">
        {{/* Phần nội dung thông tin */}}
        <div>
            <h4 class="meta-box-title mb-3 pb-2 border-bottom">
                <i class="fas fa-info-circle me-2 text-primary"></i>
                Thông số kỹ thuật
            </h4>
            <div class="meta-items-list">
                {{ with .Params.ma_san_pham }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-tag fa-fw me-1 text-muted"></i> Mã SP:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.chat_lieu }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-gem fa-fw me-1 text-muted"></i> Chất liệu:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.mau_sac }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-palette fa-fw me-1 text-muted"></i> Màu sắc:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.kich_thuoc }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-ruler-combined fa-fw me-1 text-muted"></i> Kích thước:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.xuat_xu }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-map-marker-alt fa-fw me-1 text-muted"></i> Xuất xứ:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.bao_hanh }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-shield-alt fa-fw me-1 text-muted"></i> Bảo hành:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.thuong_hieu }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-copyright fa-fw me-1 text-muted"></i> Thương hiệu:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                 {{ with .Params.gia_ban }}
                 <div class="meta-item d-flex mb-2 align-items-center">
                     <strong class="meta-label me-2" style="min-width: 100px;"><i class="fas fa-dollar-sign fa-fw me-1 text-muted"></i> Giá:</strong>
                     <span class="meta-value fw-bold text-danger fs-5">{{ . }}</span>
                 </div>
                 {{ end }}
            </div>
        </div>

        {{/* Phần Buttons (Thêm vào cuối cùng, dùng mt-auto để đẩy xuống) */}}
        <div class="mt-auto"> {{/* Container để đẩy nút xuống dưới */}}
            {{/* Class d-flex được giữ lại, gap-3 đã bị xóa */}}
            {{/* CSS custom sẽ xử lý padding 15px hai bên và gap 15px ở giữa */}}
            <div class="meta-box-buttons mt-4 pt-3 border-top d-flex">
                <a href="tel:0972612669" class="btn btn-primary btn-sm shadow-sm rounded flex-grow-1 text-center" role="button">
                    <i class="fas fa-calculator me-1"></i> Nhận Báo Giá
                </a>
                <a href="tel:0972612669" class="btn btn-primary btn-sm shadow-sm rounded flex-grow-1 text-center" role="button">
                   <i class="fas fa-phone me-1"></i> 0972612669
                </a>
            </div>
        </div>
    </div>
    {{/* Fallback nếu không có param nào của noi-that */}}
    {{ end }}

{{/* --- Logic cho Section/Type "du-an" --- */}}
{{ else if or (eq $currentSection "du-an") (eq $currentType "du-an") }}
    {{ $hasDuAnParams := false }}
    {{ $duAnFields := slice "chu_dau_tu" "dia_chi_thi_cong" "loai_hinh" "phong_cach" "vat_lieu_chinh" "don_vi" "tong_dien_tich_xd" "nam_thuc_hien" }}
    {{ range $duAnFields }}
        {{ if isset $.Params . }}
            {{ $hasDuAnParams = true }}
        {{ end }}
    {{ end }}

    {{ if $hasDuAnParams }}
     {{/* Thêm d-flex flex-column */}}
    <div class="meta-box meta-box-decorated p-3 border rounded h-100 shadow-sm d-flex flex-column">
        {{/* Phần nội dung thông tin */}}
        <div>
            <h4 class="meta-box-title mb-3 pb-2 border-bottom">
                <i class="fas fa-clipboard-list me-2 text-primary"></i>
                Thông Tin Dự Án
            </h4>
            <div class="meta-items-list">
                {{ with .Params.chu_dau_tu }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-user-tie fa-fw me-1 text-muted"></i> Chủ đầu tư:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.dia_chi_thi_cong }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-map-marker-alt fa-fw me-1 text-muted"></i> Địa chỉ thi công:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.loai_hinh }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-building fa-fw me-1 text-muted"></i> Loại hình:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.phong_cach }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-drafting-compass fa-fw me-1 text-muted"></i> Phong cách:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.vat_lieu_chinh }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-tree fa-fw me-1 text-muted"></i> Vật liệu chính:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.don_vi }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-hard-hat fa-fw me-1 text-muted"></i> Đơn vị:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.tong_dien_tich_xd }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-ruler-combined fa-fw me-1 text-muted"></i> Tổng diện tích XD:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
                {{ with .Params.nam_thuc_hien }}
                <div class="meta-item d-flex mb-2 align-items-center">
                    <strong class="meta-label me-2" style="min-width: 140px;"><i class="fas fa-calendar-alt fa-fw me-1 text-muted"></i> Năm thực hiện:</strong>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
            </div>
        </div>

        {{/* Phần Buttons (Thêm vào cuối cùng, dùng mt-auto để đẩy xuống) */}}
        <div class="mt-auto"> {{/* Container để đẩy nút xuống dưới */}}
             {{/* Class d-flex được giữ lại, gap-3 đã bị xóa */}}
             {{/* CSS custom sẽ xử lý padding 15px hai bên và gap 15px ở giữa */}}
             <div class="meta-box-buttons mt-4 pt-3 border-top d-flex">
                 <a href="tel:0972612669" class="btn btn-primary btn-sm shadow-sm rounded flex-grow-1 text-center" role="button">
                     <i class="fas fa-calculator me-1"></i> Nhận Báo Giá
                 </a>
                 <a href="tel:0972612669" class="btn btn-primary btn-sm shadow-sm rounded flex-grow-1 text-center" role="button">
                    <i class="fas fa-phone me-1"></i> 0972612669
                 </a>
             </div>
         </div>
    </div>
    {{/* Fallback nếu không có param nào của du-an */}}
    {{ end }}

{{/* --- Thêm các section khác nếu cần bằng else if --- */}}
{{/*
{{ else if or (eq $currentSection "section-khac") (eq $currentType "section-khac") }}
    ... logic cho section khác ...
*/}}

{{ else }}
    {{/* Fallback chung nếu section/type không khớp hoặc không có param nào được đặt */}}
    {{/* Bạn có thể để trống hoặc hiển thị một nội dung mặc định nếu muốn */}}
{{ end }}